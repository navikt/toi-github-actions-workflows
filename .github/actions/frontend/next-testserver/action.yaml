name: 'Start Next.js Testserver'
description: 'Starter en Next.js testserver for testing formÃ¥l'

inputs:
  test-standalone:
    description: 'Bygg med testmodus og bruk standalone-server i stedet for next dev'
    required: false
    default: 'false'

runs:
  using: 'composite'
  steps:
    - name: ðŸ”„ Hent Kildekode
      uses: actions/checkout@v4

    - name: Restore workspace
      uses: actions/cache/restore@v4
      with:
        path: .
        key: workspace-${{ github.sha }}

    - name: ðŸ“¥ Sett opp pnpm
      uses: pnpm/action-setup@v4
      with:
        version: 9.14.2

    - name: ðŸ“¦ Sett opp Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '22.20.0'
        registry-url: 'https://npm.pkg.github.com'

    - name: Install Playwright Browsers
      shell: bash
      run: pnpm exec playwright install chromium

    - name: Build and start standalone server
      if: inputs.test-standalone == 'true'
      shell: bash
      run: |
        pnpm test-build
        cp -r public .next/standalone/
        cp -r .next/static .next/standalone/.next/
        PORT=1337 node .next/standalone/server.js &

    - name: Start Next.js app in dev mode
      if: inputs.test-standalone != 'true'
      shell: bash
      run: pnpm test-dev &