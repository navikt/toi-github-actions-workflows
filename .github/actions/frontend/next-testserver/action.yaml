name: 'Start Next.js Testserver'
description: 'Starter en Next.js testserver for testing formÃ¥l'

runs:
  using: 'composite'
  steps:
    - name: Restore test workspace
      uses: actions/cache/restore@v4
      with:
        path: .
        key: test-workspace-${{ github.sha }}
        fail-on-cache-miss: true

    - name: ðŸ“¥ Sett opp pnpm
      uses: pnpm/action-setup@v4
      with:
        version: 9.14.2

    - name: ðŸ“¦ Sett opp Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '22.20.0'
        registry-url: 'https://npm.pkg.github.com'

    - name: Install Playwright Browsers
      shell: bash
      run: pnpm exec playwright install chromium

    - name: Start standalone server
      shell: bash
      run: |
        cp -r public .next/standalone/
        cp -r .next/static .next/standalone/.next/
        PORT=1337 node .next/standalone/server.js &
